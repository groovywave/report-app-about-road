<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>中央ピン固定・GSI地図</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    #map {
      height: 60vh;
      width: 100vw;
      margin-bottom: 1em;
      position: relative;
    }
    #centerPin {
      position: absolute;
      z-index: 1000;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -100%); /* ピン画像の底辺が中央に来るように調整 */
      pointer-events: none;
      width: 40px; /* ピンのサイズ調整 */
      height: 40px;
      user-select: none;
    }
  </style>
</head>
<body>
  <h2>地図を動かして位置を選択（中央ピン固定）</h2>
  <div id="map">
    <!-- 画面中央ピン画像（Leafletデフォルトアイコン） -->
    <img id="centerPin" src="https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png" alt="center pin" />
  </div>
  <p id="coords"></p>
  <button id="useLocation">この位置を使う</button>
  <form id="reportForm">
    <input type="hidden" id="latitude" name="latitude">
    <input type="hidden" id="longitude" name="longitude">
    <button type="submit">送信</button>
  </form>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // 1. 地図の初期化
    var initialLat = 35.681236, initialLng = 139.767125;
    var map = L.map('map').setView([initialLat, initialLng], 16);

    // 2. GSI日本語タイル
    L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', {
      attribution: "地理院タイル（GSI）",
      maxZoom: 18,
      minZoom: 5
    }).addTo(map);

    // 3. 地図移動時に中央座標を取得・表示
    function updateCenterCoords() {
      var center = map.getCenter();
      document.getElementById('coords').innerText =
        '緯度: ' + center.lat.toFixed(6) + '　経度: ' + center.lng.toFixed(6);
    }
    map.on('move', updateCenterCoords);
    updateCenterCoords();

    // 4. 現在地取得
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(pos){
        var lat = pos.coords.latitude, lng = pos.coords.longitude;
        map.setView([lat, lng], 18);
        updateCenterCoords();
      });
    }

    // 5. 「この位置を使う」ボタンで地図中央座標をフォームにセット
    document.getElementById('useLocation').onclick = function(){
      var center = map.getCenter();
      document.getElementById('latitude').value = center.lat;
      document.getElementById('longitude').value = center.lng;
      alert('この位置で登録します');
    };

    // 6. 送信処理（サンプル）
    document.getElementById('reportForm').onsubmit = function(e){
      e.preventDefault();
      alert(
        "送信データ：\n緯度: " + document.getElementById('latitude').value +
        "\n経度: " + document.getElementById('longitude').value
      );
      // ここでfetch送信など実装
    };
  </script>
</body>
</html>

